function searchJudge(t){"查询地区主页"!=t?readData(t,0):hide()}function readData(t,e){keyvalueOld=t,$.ajax({type:"GET",url:"http://toy1.weather.com.cn/search?cityname="+t,dataType:"jsonp",requestCount:++requestCount,jsonp:"callback",jsonpCallback:"success_jsonpCallback",timeout:3e3,async:!1,success:function(n){requestCount===this.requestCount&&(0==e&&(""==n?($("#show ul").html("<span style='color:#f00;'>对不起，未找到您查询的城市天气!</a></span>"),$("#show").show()):displayData(t,n)),1==e&&(""==n?window.location="http://www.weather.com.cn/forecast/index.shtml#input":(displayData(t,n),areaid=$("#show li.select").attr("num"),regEn.test(areaid)&&(window.location="http://www.weather.com.cn/html/province/"+areaid+".shtml#input"),regNum.test(areaid)&&(window.location="http://www.weather.com.cn/weather1d/"+areaid+".shtml#input"))))},error:function(){1==e&&(window.location="http://www.weather.com.cn/weather1d/"+areaid+".shtml#input")}})}function displayData(t,e){var n=[];$.each(e,function(t,e){n[t]=e.ref.split("~")});var i=n.sort(by("0")),a="",r="";regNum.test(t)&&$.each(i,function(e,n){var i=n[2]+"-"+n[9],a=RegExp(t,"ig");return a.test(n[6])&&(i+="-"+n[6]),a.test(n[7])&&(i+="-"+n[7]),i=i.replace(a,"<b>"+t+"</b>"),0==e&&(r+='<li class="select" num='+n[0]+">"+i+"</li>"),12>e&&e>0&&(r+='<li class="unselect" num='+n[0]+">"+i+"</li>"),11==e?!1:void 0}),regEn.test(t)&&$.each(i,function(e,n){var i=""!=n[9]?n[2]+"-"+n[9]:n[2],a=RegExp(t,"ig");return a.test(n[3])&&(i+="-"+n[3]),a.test(n[5])&&(i=n[2]+"-"+n[9]+"-"+n[5]),i=i.replace(a,"<b>"+t+"</b>"),a.test(n[8])&&(i+="-<b>"+n[8].toUpperCase()+"</b>"),0==e&&(r+='<li class="select" num='+n[0]+">"+i+"</li>"),12>e&&e>0&&(r+='<li class="unselect" num='+n[0]+">"+i+"</li>"),11==e?!1:void 0}),regCn.test(t)&&$.each(i,function(e,n){var i=""!=n[9]?n[2]+"-"+n[9]:n[2],a=RegExp(t,"ig"),a=RegExp(t,"ig"),i=i.replace(a,"<b>"+t+"</b>");return 0==e&&(r+='<li class="select" num='+n[0]+">"+i+"</li>"),12>e&&e>0&&(r+='<li class="unselect" num='+n[0]+">"+i+"</li>"),11==e?!1:void 0}),$("#show ul").html(r),$("#show").show(),$("#show li").mouseover(function(){$("#show li.select").removeClass("select").addClass("unselct"),$(this).removeClass("unselect").addClass("select")}).mouseout(function(){$(this).removeClass("select").addClass("unselect")}).click(function(){var t=$("#show li.select").text(),t=t.split("-");a=$("#show li.select").attr("num"),regEn.test(a)&&(window.location="http://www.weather.com.cn/html/province/"+a+".shtml#input"),regNum.test(a)&&(window.location="http://www.weather.com.cn/weather1d/"+a+".shtml#input"),1<t.length&&$("#txtZip").val(t[0]),hide()})}function hide(){$("#show").hide()}function keysearch(t){38==t.keyCode||40==t.keyCode||13==t.keyCode||27==t.keyCode||9==t.keyCode?(40==t.keyCode&&(""!=$("#show li.select").next().text()?$("#show li.select").removeClass("select").addClass("unselect").next().removeClass("unselect").addClass("select"):($("#show li.select").removeClass("select").addClass("unselect"),$("#show li:first").removeClass("unselect").addClass("select"))),38==t.keyCode&&(""!=$("#show li.select").prev().text()?$("#show li.select").removeClass("select").addClass("unselect").prev().removeClass("unselect").addClass("select"):($("#show li.select").removeClass("select").addClass("unselect"),$("#show li:last").removeClass("unselect").addClass("select"))),13==t.keyCode&&(t=$("#show li.select").text(),t=t.split("-"),areaid=$("#show li.select").attr("num"),regEn.test(areaid)&&(window.location="http://www.weather.com.cn/html/province/"+areaid+".shtml#input"),regNum.test(areaid)&&(window.location="http://www.weather.com.cn/weather1d/"+areaid+".shtml#input"),1<t.length&&$("#txtZip").val(t[0]),hide())):0==$("#txtZip").val().length&&hide()}function istrue(t){var e=/^((?=[0-9]+[A])|[0-9]+(?=[0-9]))[a-z0-9]+$/gi;return e.test(t)}var by=function(t){return function(e,n){var i,a;if("object"==typeof e&&"object"==typeof n&&e&&n)return i=e[t],a=n[t],i===a?0:typeof i==typeof a?a>i?-1:1:typeof a>typeof i?-1:1;throw"error"}},requestCount=0,keyvalueOld="",regNum=/^[0-9]*[0-9][0-9]A*$/,regEn=/^[A-Za-z]+$/,regCn=RegExp("[一-龥]"),requestOccur=0;define(function(require){function initDzCity(){DZ._initCookieDatas()}function cookieMaker(t,e,n){if("undefined"==typeof e){var i=null;if(document.cookie&&""!=document.cookie)for(var a=document.cookie.split(";"),r=0;r<a.length;r++){var o=jQuery.trim(a[r]);if(o.substring(0,t.length+1)==t+"="){i=decodeURIComponent(o.substring(t.length+1));break}}return i}n=n||{},null===e&&(e="",n.expires=-1);var s="";if(n.expires&&("number"==typeof n.expires||n.expires.toUTCString)){var l;"number"==typeof n.expires?(l=new Date,l.setTime(l.getTime()+1e3*60*60*24*n.expires)):l=n.expires,s="; expires="+l.toUTCString()}var c=n.path?"; path="+n.path:"",d=n.domain?"; domain="+n.domain:"",p=n.secure?"; secure":"";document.cookie=[t,"=",encodeURIComponent(e),s,c,d,p].join("")}require("jquery"),$(".city-tt a").click(function(t){t.stopPropagation(),$(this).addClass("cur").siblings().removeClass("cur"),$(".w_city").eq($(".city-tt a").index($(this))).show().siblings(".w_city").hide()}),$(".text").click(function(){$(".city-box").addClass("show_head")}),$(".city-tt b").click(function(){$(".city-box").hide()}),$(".sjz").click(function(){$(".provinceLinks").animate({height:"toggle"},"normal")}),$(".menu a[id="+$("#colorid").val()+"]").addClass("color");var navid=$(".nav a").attr("id"),dizhi=window.location.href,dizhi=dizhi.split("/"),dizhi=dizhi.pop().split("."),str=dizhi[0];if(istrue(str)){var aaa=str.length;if(7==aaa){var rs="http://wgeo.weather.com.cn/ip/";$.getScript(rs,function(){$.getScript("http://d1.weather.com.cn/index_around/"+id+".html",function(){var t=around.n;$.each(t,function(t,e){$(".city_guonei").eq(1).find("dd").eq(0).append("<a href='http://www.weather.com.cn/weather1d/"+e.ac+".shtml' title='"+e.an+"'>"+e.an+"</a>")});var e=around.jd;$.each(e,function(t,e){$(".city_guonei").eq(1).find("dd").eq(1).append("<a href='http://www.weather.com.cn/weather1d/"+e.ac+".shtml' title='"+e.an+"'>"+e.an+"</a>")})})})}else $.getScript("http://d1.weather.com.cn/index_around/"+dizhi[0]+".html",function(){var t=around.n;$.each(t,function(t,e){$(".city_guonei").eq(1).find("dd").eq(0).append("<a href='http://www.weather.com.cn/weather1d/"+e.ac+".shtml#around1' title='"+e.an+"'>"+e.an+"</a>")});var e=around.jd;$.each(e,function(t,e){$(".city_guonei").eq(1).find("dd").eq(1).append("<a href='http://www.weather.com.cn/weather1d/"+e.ac+".shtml#around1' title='"+e.an+"'>"+e.an+"</a>")})})}else{var rs="http://wgeo.weather.com.cn/ip/";$.getScript(rs,function(){$.getScript("http://d1.weather.com.cn/index_around/"+id+".html",function(){var t=around.n;$.each(t,function(t,e){$(".city_guonei").eq(1).find("dd").eq(0).append("<a href='http://www.weather.com.cn/weather1d/"+e.ac+".shtml#around1' title='"+e.an+"'>"+e.an+"</a>")});var e=around.jd;$.each(e,function(t,e){$(".city_guonei").eq(1).find("dd").eq(1).append("<a href='http://www.weather.com.cn/weather1d/"+e.ac+".shtml#around1' title='"+e.an+"'>"+e.an+"</a>")})})})}$("#txtZip").focus(function(){(""==$("#txtZip").val()||"查询地区主页"==$("#txtZip").val())&&($("#idss").show(),hide()),$(this).val()==this.defaultValue?$(this).val(""):""!=$("#txtZip").val()&&"查询地区主页"!=$("#txtZip").val()&&$("#show").show(),setInterval(function(){var t=$("#txtZip").val();""==t&&hide(),t!=keyvalueOld&&($("#idss").hide(),searchJudge(t))},300),$(".city-box").show()}),$(document).click(function(){""==$("#txtZip").val()?($("#show").hide(),$("#txtZip").val("查询地区主页")):$("#show").hide()}),$("#txtZip").add("#selectsionTabs").click(function(t){return t.stopPropagation(),!1}),$("#selectsionTabs span").click(function(){var t=$("#selectsionTabs span").index(this);$("#selectsionGroups ul").hide(),$("#selectsionGroups ul").eq(t).show(),$("#selectsionTabs span").removeClass("active"),$(this).addClass("active")}),$("#selectsionTabs .tab").click(function(){return event.stopPropagation(),!1}),$("#btnZip").bind("click",function(t){return t.stopPropagation(),t=$("#txtZip").val(),""==t||"查询地区主页"==$.trim(t)?(window.location="http://www.weather.com.cn/forecast/index.shtml#input",!1):(readData(t,1),void 0)}),$("#txtZip").keyup(function(t){var e=$("#txtZip");e.offset(),e.height(),""==$("#txtZip").val()&&(keyvalueOld=""),keysearch(t)}),$(document).click(function(){$(".city-box").hasClass("show_head")&&$(".city-box").hide()});var DZ={COOKIE_NAME:"f_city",default_id:101010100,default_name:"北京,北京,北京",weaJsonUrl:"http://d1.weather.com.cn/dingzhi/_id_.html",cookieDatas:[],_initCookieDatas:function(){$(".w_weather").empty();var t=cookieMaker(DZ.COOKIE_NAME);if(DZ.cookieDatas=[],t){for(var e=t.split(","),n=0,i=e.length;i>n;n++){var a=e[n].split("|");DZ.cookieDatas.unshift({cityName:a[0],cityId:a[1],cityCusName:a[2]})}DZ._goWeaDatas()}else $.ajax({type:"get",dataType:"script",url:"http://wgeo.weather.com.cn/ip/",success:function(){var t={cityName:addr.split(",").pop(),cityId:id,cityCusName:""};DZ.cookieDatas.push(t),DZ._goWeaDatas();var e=t.cityName+"|"+t.cityId+"|"+t.cityCusName;cookieMaker(DZ.COOKIE_NAME,e,{expires:999,path:"/",domain:"weather.com.cn"})}});$(".w_weather .delete").live("click",function(){var t=$(this).parents("li").attr("data-n");DZ._remove(t),DZ._goWeaDatas()})},_remove:function(t){for(var e=[],n=DZ.cookieDatas.length-1;n>=0;n--){var i=DZ.cookieDatas[n];i.cityId==t?DZ.cookieDatas.splice(n,1):e.push(i.cityName+"|"+i.cityId+"|"+i.cityCusName)}cookieMaker(DZ.COOKIE_NAME,e.join(","),{expires:999,path:"/",domain:"weather.com.cn"})},_goWeaDatas:function(){function gets(){var d=DZ.cookieDatas[point];$.ajax({type:"get",dataType:"script",url:DZ.weaJsonUrl.replace("_id_",d.cityId),success:function(){var city=eval("cityDZ"+d.cityId).weatherinfo,weaDatas={id:city.city,name:city.cityname,tem1:city.temp,tem2:city.tempn,txt:city.weather,icon1:city.weathercode,icon2:city.weathercoden,wind:city.wd,windl:city.ws,alarms:eval("alarmDZ"+d.cityId).w},moreClass=DZ.cookieDatas.length>1&&"dz_right"||"";point==DZ.cookieDatas.length-1?DZ._setDomHeadCity(weaDatas,moreClass):DZ._setDomMoreCity(weaDatas),point--?gets():$(".w_weather ul").append('<li class="add"> <a href="http://www.weather.com.cn/profile/city.shtml"  target="_self">+</a> </li>')}})}var point=DZ.cookieDatas.length-1;gets()},_setDomHeadCity:function(t,e){var n='<a href="http://www.weather.com.cn/weather1d/'+t.id+'.shtml#dingzhi_first" target="_self" title="'+t.txt+'"><span class="city_name"><em>'+t.name+'</em></span> <big class="icon '+t.icon1+' fl"></big> <big class="icon '+t.icon2+' fl"></big> <em class="fl s">'+t.tem1+"/"+t.tem2+"</em> </a>";t.alarms.length&&(n+='<a class="fl w_yj" href="http://www.weather.com.cn/alarm/newalarmlist.shtml?areaId='+t.id+'"></a>'),n+='<a class="add fl '+e+'" href="http://www.weather.com.cn/profile/city.shtml" target="_self">+</a>',n+='<ul class="more" style="display: none;"></ul>',$(".w_weather").empty().html(n)},_setDomMoreCity:function(t){function e(t){t.live("mouseover mouseout",function(t){"mouseover"==t.type?(l.show(),c.addClass("dz_down")):(l.hide(),c.removeClass("dz_down"))})}var n="";t.alarms.length&&(n='<em class="w_yj"></em>'),$(".w_weather ul").append('<li data-n="'+t.id+'"><a title="'+t.txt+'" target="_self" href="http://www.weather.com.cn/weather1d/'+t.id+'.shtml#dingzhi_more" class="clearfix"><span>'+t.name+'</span><big class="'+t.icon1+' ic"></big><big class="'+t.icon2+' ic"></big><em>'+t.tem1+"/"+t.tem2+'</em></a><b class="delete"></b></li>');var i=$(".w_weather"),a=i.find(".city_name"),r=a.children("em"),o=a.width(),s=r.width();s>o&&r.hover(function(){$(this).stop(!0).animate({left:"-"+(s-o)+"px"},"slow")},function(){$(this).css("left","0px")});var l=i.find(".more");e(l);var c=i.find("a.dz_right");e(c)}};DZ._initCookieDatas();var Event=require("../m_event"),dzEvent=(W.data||(W.data={}))["event.dz_city"]=new Event;dzEvent.on("modify",DZ._initCookieDatas)});